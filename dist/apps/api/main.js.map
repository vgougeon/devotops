{"version":3,"file":"main.js","mappings":";;;;;;;;;;AAAA,iDAAiC;AACjC,6CAAyB;AACzB,4DAA0B;AAC1B,gDAAoC;AACpC,MAAM,MAAM,GAAG,gBAAM,EAAE;AAEvB,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,GAAG,EAAE,GAAG,EAAE,EAAE;IAC/B,MAAM,IAAI,GAAW,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC;IACnC,OAAO,CAAC,GAAG,CAAC,cAAc,EAAE,OAAO,CAAC,GAAG,CAAC,mBAAmB,CAAC;IAC5D,OAAO,CAAC,GAAG,CAAC,kBAAkB,EAAE,OAAO,CAAC,GAAG,CAAC,gBAAgB,CAAC;IAC7D,eAAK,CAAC,IAAI,CAAC,6CAA6C,EAAE;QACtD,SAAS,EAAE,OAAO,CAAC,GAAG,CAAC,mBAAmB;QAC1C,aAAa,EAAE,OAAO,CAAC,GAAG,CAAC,gBAAgB;QAC3C,IAAI;KACP,EAAE,EAAE,OAAO,EAAE,EAAE,QAAQ,EAAE,kBAAkB,EAAE,EAAE,CAAC,CAAC,IAAI,CAAC,CAAO,QAAQ,EAAE,EAAE;QACtE,MAAM,IAAI,GAAG,MAAM,eAAK,CAAC,IAAI,CAAC,6BAA6B,EAAE,IAAI,EAAE;YAC/D,OAAO,EAAE;gBACL,eAAe,EAAE,UAAU,QAAQ,CAAC,IAAI,CAAC,YAAY,EAAE;aAC1D;SACJ,CAAC;QACF,IAAI,MAAM,GAAG,MAAM,YAAE,CAAC,OAAO,CAAC,CAAC,KAAK,CAAC,EAAE,QAAQ,EAAE,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC,KAAK,EAAE;QACxE,IAAI,CAAC,MAAM,EAAE;YACT,MAAM,CAAC,EAAE,CAAC,GAAG,MAAM,YAAE,CAAC,OAAO,CAAC,CAAC,MAAM,CAAC;gBAClC,QAAQ,EAAE,IAAI,CAAC,IAAI,CAAC,EAAE;gBACtB,QAAQ,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK;gBACzB,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI;gBACpB,MAAM,EAAE,IAAI,CAAC,IAAI,CAAC,UAAU;aAC/B,CAAC;YACF,MAAM,GAAG,MAAM,YAAE,CAAC,OAAO,CAAC,CAAC,KAAK,CAAC,EAAE,QAAQ,EAAE,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC,KAAK,EAAE;SACvE;QAED,MAAM,QAAQ,GAAG,GAAG,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAE,MAAM,CAAC,QAAQ,EAAE,EAAE,QAAQ,CAAC;QAElE,GAAG,CAAC,IAAI,CAAC;YACL,IAAI,EAAE,IAAI,CAAC,IAAI;YACf,QAAQ;YACR,KAAK,EAAE,QAAQ,CAAC,IAAI,CAAC,YAAY;SACpC,CAAC;IACN,CAAC,EAAC,CAAC,KAAK,CAAC,CAAC,KAAK,EAAE,EAAE;QACf,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC;QAClB,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC;IAC3B,CAAC,CAAC;AACN,CAAC,CAAC;AAEF,MAAM,CAAC,GAAG,CAAC,KAAK,EAAE,CAAC,GAAG,EAAE,GAAG,EAAE,EAAE;IAC3B,MAAM,KAAK,GAAG,GAAG,CAAC,IAAI,CAAC,KAAK;IAE5B,6BAA6B;IAC7B,qEAAqE;IACrE,8CAA8C;IAC9C,kCAAkC;IAClC,qCAAqC;IACrC,gCAAgC;IAChC,wCAAwC;IACxC,KAAK;AACT,CAAC,CAAC;AAEF,MAAM,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC,GAAG,EAAE,GAAG,EAAE,EAAE;IACjC,OAAO,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC;AAC7B,CAAC,CAAC;AAEF,MAAM,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC,GAAG,EAAE,GAAG,EAAE,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;AAEnD,qBAAe,MAAM;;;;;;;;;;;AC/DrB,iDAAiC;AACjC,4DAA0B;AAC1B,mFAA2C;AAC3C,gDAAoC;AACpC,6CAA0B;AAC1B,MAAM,MAAM,GAAG,gBAAM,EAAE;AAEvB,MAAM,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAO,GAAG,EAAE,GAAG,EAAE,EAAE;IACpC,GAAG,CAAC,IAAI,CAAC,MAAM,oBAAI,CAAC,KAAK,EAAE,CAAC;AAChC,CAAC,EAAC;AAEF,MAAM,CAAC,IAAI,CAAC,WAAW,EAAE,CAAO,GAAG,EAAE,GAAG,EAAE,EAAE;IACxC,MAAM,CAAC,EAAE,CAAC,GAAG,MAAM,YAAE,CAAC,UAAU,CAAC,CAAC,MAAM,CAAC;QACrC,IAAI,EAAE,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI;QAC3B,QAAQ,EAAE,GAAG,CAAC,IAAI,CAAC,QAAQ;QAC3B,QAAQ,EAAE,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;QACnC,GAAG,EAAE,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS;KAClC,EAAE,GAAG,CAAC;IAEP,MAAM,OAAO,GAAG,MAAM,YAAE,CAAC,UAAU,CAAC,CAAC,KAAK,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,KAAK,EAAE;IAE1D,IAAI;QACA,eAAK,CAAC,IAAI,CAAC,4CAA4C,EAAE;YACrD,GAAG,EAAE,OAAO,CAAC,GAAG;YAChB,EAAE,EAAE,OAAO,CAAC,EAAE;YACd,QAAQ,EAAE,OAAO,CAAC,QAAQ;SAC7B,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE;YACT,OAAO,CAAC,GAAG,CAAC,iBAAiB,EAAE,OAAO,CAAC,EAAE,EAAE,OAAO,CAAC,QAAQ,CAAC;QAChE,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,EAAE,GAAG,OAAO,CAAC,GAAG,CAAC,WAAW,CAAC,GAAC,CAAC;QAE3C,OAAO,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC;KAC3B;IACD,WAAM;QACF,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC;KAChD;AAGL,CAAC,EAAC;AAEF,MAAM,CAAC,GAAG,CAAC,WAAW,EAAE,CAAO,GAAG,EAAE,GAAG,EAAE,EAAE;IACvC,MAAM,KAAK,GAAG,GAAG,CAAC,OAAO,CAAC,eAAe,CAAC;IAC1C,MAAM,OAAO,GAAG,GAAG,CAAC,MAAM,CAAC,KAAK,EAAE,QAAQ,CAAQ;IAClD,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC;IAEpB,MAAM,OAAO,GAAG,MAAM,YAAE,CAAC,UAAU,CAAC,CAAC,KAAK,CAAC,EAAE,QAAQ,EAAE,OAAO,CAAC,QAAQ,EAAE,CAAC;IAE1E,OAAO,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC;AAC5B,CAAC,EAAC;AAEF,MAAM,CAAC,GAAG,CAAC,eAAe,EAAE,CAAO,GAAG,EAAE,GAAG,EAAE,EAAE;IAC3C,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC;IAC1B,MAAM,OAAO,GAAG,MAAM,YAAE,CAAC,UAAU,CAAC,CAAC,KAAK,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,MAAM,CAAC,EAAE,EAAE,CAAC,CAAC,KAAK,EAAE;IACzE,IAAI,CAAC,OAAO;QAAE,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC;IAEpC,IAAI;QACA,MAAM,MAAM,GAAG,MAAM,eAAK,CAAC,IAAI,CAAC,wCAAwC,EAAE,EAAE,EAAE,EAAE,GAAG,CAAC,MAAM,CAAC,EAAE,EAAE,CAAC;QAChG,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC;KACnB;IACD,WAAM;QACF,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC;KACzC;AACL,CAAC,EAAC;AACF,qBAAe,MAAM;;;;;;;;;;AC9DrB,qDAAkC;AAClC,2CAAuB;AAEvB,OAAO,CAAC,GAAG,CAAC,kBAAkB,CAAC;AAC/B,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,UAAU,CAAC;AAC3C,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,UAAU,CAAC;AAC3C,OAAO,CAAC,GAAG,CAAC,UAAU,EAAE,OAAO,CAAC,GAAG,CAAC,cAAc,CAAC;AACnD,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,UAAU,CAAC;AAC3C,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,UAAU,CAAC;AAC3C,MAAM,EAAE,GAAG,cAAI,CAAC;IACd,MAAM,EAAE,QAAQ;IAChB,gBAAgB,EAAE,IAAI;IACtB,UAAU,EAAE;QACV,IAAI,EAAG,OAAO,CAAC,GAAG,CAAC,UAAU;QAC7B,IAAI,EAAG,OAAO,CAAC,GAAG,CAAC,UAAU;QAC7B,QAAQ,EAAG,OAAO,CAAC,GAAG,CAAC,cAAc;QACrC,QAAQ,EAAG,OAAO,CAAC,GAAG,CAAC,UAAU;QACjC,IAAI,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,UAAU;KAC9B;CACF,CAAC,CAAC;AACH,iBAAK,CAAC,IAAI,CAAC,EAAE,CAAC;AACd,qBAAe,EAAE,CAAC;;;;;;;;;;ACrBlB,qDAAkC;AAElC,MAAM,IAAK,SAAQ,iBAAK;IACtB,MAAM,KAAK,SAAS;QAClB,OAAO,OAAO,CAAC;IACjB,CAAC;CAUF;AAED,qBAAe,IAAI;;;;;;;;ACjBnB;;;;;;;ACAA;;;;;;;ACAA;;;;;;;ACAA;;;;;;;ACAA;;;;;;;ACAA;;;;;;;ACAA;;;;;;;ACAA;;;;;;UCAA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;;;;;ACtBA,+CAAmC;AACnC,yCAA8B;AAC9B,uFAAmD;AACnD,uFAAmD;AACnD,oCAAwB,EAAE;AAC1B,mBAAO,CAAC,yBAAS,CAAC;AAElB,MAAM,GAAG,GAAG,OAAO,EAAE,CAAC;AACtB,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,UAAU,EAAE,CAAC;AAC7B,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC;AAEvB,GAAG,CAAC,GAAG,CAAC,MAAM,EAAE,yBAAc,CAAC;AAC/B,GAAG,CAAC,GAAG,CAAC,MAAM,EAAE,yBAAc,CAAC;AAE/B,GAAG,CAAC,GAAG,CAAC,GAAG,EAAE,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,oBAAoB,CAAC,CAAC,CAAC;AACxE,GAAG,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC,GAAG,EAAE,GAAG,EAAE,EAAE;IACxB,GAAG,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,8BAA8B,CAAC,CAAC;AACpE,CAAC,CAAC;AACF,MAAM,IAAI,GAAG,IAAI,CAAC;AAClB,MAAM,MAAM,GAAG,GAAG,CAAC,MAAM,CAAC,IAAI,EAAE,GAAG,EAAE;IACnC,OAAO,CAAC,GAAG,CAAC,0BAA0B,IAAI,EAAE,CAAC,CAAC;AAChD,CAAC,CAAC,CAAC;AACH,MAAM,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,KAAK,CAAC,CAAC","sources":["webpack://devotops/./apps/api/src/app/auth.controller.ts","webpack://devotops/./apps/api/src/app/user.controller.ts","webpack://devotops/./apps/api/src/db/db.ts","webpack://devotops/./apps/api/src/db/models/user.model.ts","webpack://devotops/external commonjs \"axios\"","webpack://devotops/external commonjs \"dotenv\"","webpack://devotops/external commonjs \"express\"","webpack://devotops/external commonjs \"jsonwebtoken\"","webpack://devotops/external commonjs \"knex\"","webpack://devotops/external commonjs \"objection\"","webpack://devotops/external commonjs \"tslib\"","webpack://devotops/external node-commonjs \"path\"","webpack://devotops/webpack/bootstrap","webpack://devotops/./apps/api/src/main.ts"],"sourcesContent":["import { Router } from 'express';\r\nimport axios from 'axios'\r\nimport db from '../db/db';\r\nimport * as jwt from 'jsonwebtoken';\r\nconst router = Router()\r\n\r\nrouter.post('/login', (req, res) => {\r\n    const code: string = req.body.code;\r\n    console.log('CLIENT ID : ', process.env.NX_GITHUB_CLIENT_ID)\r\n    console.log('CLIENT SECRET : ', process.env.NX_GITHUB_SECRET)\r\n    axios.post('https://github.com/login/oauth/access_token', {\r\n        client_id: process.env.NX_GITHUB_CLIENT_ID,\r\n        client_secret: process.env.NX_GITHUB_SECRET,\r\n        code,\r\n    }, { headers: { 'Accept': 'application/json' } }).then(async (response) => {\r\n        const user = await axios.post('https://api.github.com/user', null, {\r\n            headers: {\r\n                'Authorization': `Bearer ${response.data.access_token}`\r\n            }\r\n        })\r\n        let dbUser = await db('users').where({ githubId: user.data.id }).first()\r\n        if (!dbUser) {\r\n            const [id] = await db('users').insert({\r\n                githubId: user.data.id,\r\n                username: user.data.login,\r\n                name: user.data.name,\r\n                avatar: user.data.avatar_url,\r\n            })\r\n            dbUser = await db('users').where({ githubId: user.data.id }).first()\r\n        }\r\n        \r\n        const appToken = jwt.sign({ githubId: dbUser.githubId }, 'SECRET')\r\n\r\n        res.send({\r\n            user: user.data,\r\n            appToken,\r\n            token: response.data.access_token\r\n        })\r\n    }).catch((error) => {\r\n        console.log(error)\r\n        res.send(error.message)\r\n    })\r\n})\r\n\r\nrouter.get('/me', (req, res) => {\r\n    const token = req.body.token\r\n\r\n    // console.log(response.data)\r\n    // let user = await db('users').where({ githubId: response.data.id })\r\n    // if(!user) user = await db('users').insert({\r\n    //     githubId: response.data.id,\r\n    //     username: response.data.login,\r\n    //     name: response.data.name,\r\n    //     avatar: response.data.avatar_url,\r\n    // })\r\n})\r\n\r\nrouter.post('/postest', (req, res) => {\r\n    return res.send('tested')\r\n})\r\n\r\nrouter.get('/test', (req, res) => res.send('test'))\r\n\r\nexport default router","import { Router } from 'express';\r\nimport db from '../db/db';\r\nimport User from '../db/models/user.model';\r\nimport * as jwt from 'jsonwebtoken';\r\nimport axios from 'axios';\r\nconst router = Router()\r\n\r\nrouter.get('/users', async (req, res) => {\r\n    res.send(await User.query())\r\n})\r\n\r\nrouter.post('/projects', async (req, res) => {\r\n    const [id] = await db('projects').insert({\r\n        name: req.body.project.name,\r\n        template: req.body.template,\r\n        githubId: req.body.project.owner.id,\r\n        url: req.body.project.clone_url,\r\n    }, \"*\")\r\n\r\n    const project = await db('projects').where({ id }).first()\r\n\r\n    try {\r\n        axios.post('http://localhost/worker/start-container.sh', {\r\n            url: project.url,\r\n            id: project.id,\r\n            template: project.template\r\n        }).then(() => {\r\n            console.log(\"PROJECT STARTED\", project.id, project.template)\r\n        }).catch(() => { console.log('no worker')})\r\n\r\n        return res.send(project)\r\n    }\r\n    catch {\r\n        return res.status(404).send('Worker offline')\r\n    }\r\n\r\n\r\n})\r\n\r\nrouter.get('/projects', async (req, res) => {\r\n    const token = req.headers['authorization']\r\n    const payload = jwt.verify(token, 'SECRET') as any\r\n    console.log(payload)\r\n\r\n    const project = await db('projects').where({ githubId: payload.githubId })\r\n\r\n    return res.send(project)\r\n})\r\n\r\nrouter.get('/projects/:id', async (req, res) => {\r\n    console.log(req.params.id)\r\n    const project = await db('projects').where({ id: req.params.id }).first()\r\n    if (!project) return res.status(404)\r\n\r\n    try {\r\n        const status = await axios.post('http://localhost/worker/project-status', { id: req.params.id })\r\n        res.send(status)\r\n    }\r\n    catch {\r\n        res.status(404).send('Worker offline')\r\n    }\r\n})\r\nexport default router","import { Model } from \"objection\";\r\nimport knex from 'knex'\r\n\r\nconsole.log(\"CONNECTING TO DB\")\r\nconsole.log(\"HOST\", process.env.NX_DB_HOST)\r\nconsole.log(\"USER\", process.env.NX_DB_USER)\r\nconsole.log(\"PASSWORD\", process.env.NX_DB_PASSWORD)\r\nconsole.log(\"NAME\", process.env.NX_DB_NAME)\r\nconsole.log(\"PORT\", process.env.NX_DB_PORT)\r\nconst db = knex({\r\n  client: 'mysql2',\r\n  useNullAsDefault: true,\r\n  connection: {\r\n    host : process.env.NX_DB_HOST,\r\n    user : process.env.NX_DB_USER,\r\n    password : process.env.NX_DB_PASSWORD,\r\n    database : process.env.NX_DB_NAME,\r\n    port: +process.env.NX_DB_PORT\r\n  }\r\n});\r\nModel.knex(db)\r\nexport default db;","import { Model } from \"objection\";\r\n\r\nclass User extends Model {\r\n  static get tableName() {\r\n    return 'users';\r\n  }\r\n\r\n  githubId: number;\r\n  username: string;\r\n  firstName: string;\r\n  lastName: string;\r\n  avatar: string;\r\n\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\nexport default User","module.exports = require(\"axios\");","module.exports = require(\"dotenv\");","module.exports = require(\"express\");","module.exports = require(\"jsonwebtoken\");","module.exports = require(\"knex\");","module.exports = require(\"objection\");","module.exports = require(\"tslib\");","module.exports = require(\"path\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import * as express from 'express';\r\nimport path = require('path');\r\nimport authController from './app/auth.controller';\r\nimport userController from './app/user.controller';\r\nrequire('dotenv').config()\r\nrequire('./db/db')\r\n\r\nconst app = express();\r\napp.use(express.urlencoded())\r\napp.use(express.json())\r\n\r\napp.use('/api', authController)\r\napp.use('/api', userController)\r\n\r\napp.use('/', express.static(path.join(__dirname, '../user-interface/')))\r\napp.use('*', (req, res) => {\r\n  res.sendFile(path.join(__dirname, '../user-interface/index.html'))\r\n})\r\nconst port = 3333;\r\nconst server = app.listen(port, () => {\r\n  console.log(`APP : http://localhost:${port}`);\r\n});\r\nserver.on('error', console.error);\r\n"],"names":[],"sourceRoot":""}